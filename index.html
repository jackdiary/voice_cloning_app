<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒì„± í´ë¡œë‹ ì›¹ì•±</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .step {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .step h3 {
            margin-top: 0;
            color: #2c5282;
        }
        
        input[type="file"], 
        input[type="text"], 
        textarea,
        select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .error {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .success {
            color: #2e7d32;
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .features {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .features h4 {
            margin-top: 0;
            color: #1976d2;
        }
        
        audio {
            width: 100%;
            margin: 10px 0;
        }
        
        #downloadSection {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ìŒì„± í´ë¡œë‹ ì›¹ì•±</h1>
        
        <!-- ëª¨ë¸ ì´ˆê¸°í™” -->
        <div class="step">
            <h3>1. ëª¨ë¸ ì´ˆê¸°í™”</h3>
            <p>ë¨¼ì € AI ëª¨ë¸ì„ ì´ˆê¸°í™”í•´ì•¼ í•©ë‹ˆë‹¤. (ìµœì´ˆ 1íšŒ, ì•½ 1-2ë¶„ ì†Œìš”)</p>
            <button onclick="initializeModel()">ëª¨ë¸ ì´ˆê¸°í™”</button>
            <div id="initStatus"></div>
        </div>
        
        <!-- ìŒì„± íŒŒì¼ ì—…ë¡œë“œ -->
        <div class="step">
            <h3>2. ì°¸ì¡° ìŒì„± íŒŒì¼ ì—…ë¡œë“œ</h3>
            <p>í´ë¡ í•˜ê³  ì‹¶ì€ ëª©ì†Œë¦¬ì˜ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. (ìµœì†Œ 3ì´ˆ ì´ìƒ, ëª…í™•í•œ ìŒì§ˆ ê¶Œì¥)</p>
            <input type="file" id="audioFile" accept=".wav,.mp3,.flac,.m4a" onchange="uploadAudio()">
            <div id="uploadStatus"></div>
            <div id="voiceFeatures"></div>
        </div>
        
        <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ë° í•©ì„± -->
        <div class="step">
            <h3>3. í…ìŠ¤íŠ¸ ì…ë ¥ ë° ìŒì„± í•©ì„±</h3>
            <p>í•©ì„±í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³  ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            
            <label for="inputText">í•©ì„±í•  í…ìŠ¤íŠ¸:</label>
            <textarea id="inputText" placeholder="ì—¬ê¸°ì— í•©ì„±í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            
            <label for="language">ì–¸ì–´ ì„ íƒ:</label>
            <select id="language">
                <option value="ko">í•œêµ­ì–´</option>
                <option value="en">English</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="zh">ä¸­æ–‡</option>
            </select>
            
            <button onclick="synthesizeSpeech()" id="synthesizeBtn" disabled>ìŒì„± í•©ì„±</button>
            <div id="synthesisStatus"></div>
        </div>
        
        <!-- ê²°ê³¼ ë‹¤ìš´ë¡œë“œ -->
        <div id="downloadSection" style="display: none;">
            <div class="step">
                <h3>4. ê²°ê³¼ í™•ì¸ ë° ë‹¤ìš´ë¡œë“œ</h3>
                <audio id="resultAudio" controls></audio>
                <br>
                <button onclick="downloadResult()">ìŒì„± íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>
    </div>

    <script>
        let referenceFilename = '';
        let outputFilename = '';
        let modelInitialized = false;

        function showStatus(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
        }

        function showLoading(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="loading">â³ ${message}</div>`;
        }

        async function initializeModel() {
            showLoading('initStatus', 'ëª¨ë¸ì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...');
            
            try {
                const response = await fetch('/initialize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('initStatus', result.message);
                    modelInitialized = true;
                } else {
                    showStatus('initStatus', result.message, true);
                }
            } catch (error) {
                showStatus('initStatus', `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, true);
            }
        }

        async function uploadAudio() {
            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];
            
            if (!file) return;

            if (!modelInitialized) {
                showStatus('uploadStatus', 'ë¨¼ì € ëª¨ë¸ì„ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            showLoading('uploadStatus', 'íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...');

            const formData = new FormData();
            formData.append('audio', file);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showStatus('uploadStatus', result.message);
                    referenceFilename = result.filename;
                    displayVoiceFeatures(result.features);
                    document.getElementById('synthesizeBtn').disabled = false;
                } else {
                    showStatus('uploadStatus', result.message, true);
                }
            } catch (error) {
                showStatus('uploadStatus', `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, true);
            }
        }

        function displayVoiceFeatures(features) {
            const featuresDiv = document.getElementById('voiceFeatures');
            featuresDiv.innerHTML = `
                <div class="features">
                    <h4>ğŸ” ë¶„ì„ëœ ìŒì„± íŠ¹ì§•</h4>
                    <p><strong>ê¸°ë³¸ ì£¼íŒŒìˆ˜:</strong> ${features.fundamental_frequency.toFixed(2)} Hz</p>
                    <p><strong>ìŠ¤í™íŠ¸ëŸ¼ ì¤‘ì‹¬:</strong> ${features.spectral_centroid.toFixed(2)} Hz</p>
                    <p><strong>ìŒì„± ê¸¸ì´:</strong> ${features.duration.toFixed(2)} ì´ˆ</p>
                    <p><strong>ìƒ˜í”Œ ë ˆì´íŠ¸:</strong> ${features.sample_rate} Hz</p>
                    <p><small>âœ… ìŒì„± íŠ¹ì§• ì¶”ì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</small></p>
                </div>
            `;
        }

        async function synthesizeSpeech() {
            const text = document.getElementById('inputText').value.trim();
            const language = document.getElementById('language').value;

            if (!text) {
                showStatus('synthesisStatus', 'í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            if (!referenceFilename) {
                showStatus('synthesisStatus', 'ë¨¼ì € ì°¸ì¡° ìŒì„± íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', true);
                return;
            }

            showLoading('synthesisStatus', 'ìŒì„±ì„ í•©ì„±í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤... (ì•½ 30ì´ˆ-1ë¶„ ì†Œìš”)');

            try {
                const response = await fetch('/synthesize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        reference_filename: referenceFilename,
                        language: language
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showStatus('synthesisStatus', result.message);
                    outputFilename = result.output_filename;
                    
                    // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ì— ê²°ê³¼ ë¡œë“œ
                    const audio = document.getElementById('resultAudio');
                    audio.src = `/download/${outputFilename}`;
                    
                    // ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ í‘œì‹œ
                    document.getElementById('downloadSection').style.display = 'block';
                } else {
                    showStatus('synthesisStatus', result.message, true);
                }
            } catch (error) {
                showStatus('synthesisStatus', `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, true);
            }
        }

        function downloadResult() {
            if (outputFilename) {
                window.open(`/download/${outputFilename}`, '_blank');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì •
        window.onload = function() {
            document.getElementById('inputText').placeholder = 
                "ì˜ˆì‹œ: ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” AIë¡œ ìƒì„±ëœ ëª©ì†Œë¦¬ì…ë‹ˆë‹¤. ì–´ë–¤ í…ìŠ¤íŠ¸ë“  ì œê°€ ë§ì”€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
        };
    </script>
</body>
</html>
